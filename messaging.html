<html>
<head>
<script>
  var sock;
  var frame;

  window.common = {};
  function prep() {
    frame = document.getElementById('con')
    frame.contentWindow.common = {};
    frame.src = document.location.hash.substring(1)
    window.onmessage = function(evt) {
      console.log("Got socket: " + common.sock)
      common.sock.onopen = function() {
        common.sock.send(JSON.stringify([['set', 'x', 3]]) + '\n');
      }
    }
  }
</script>
</head>
<body onload="prep()">
  <iframe id="con" style="position: absolute; top: -100000"></iframe>
</body>
</html>
